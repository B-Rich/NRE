From 62310af2f38610bd3d6c5bda033d39049a5a6430 Mon Sep 17 00:00:00 2001
From: Nils Asmussen <nils@os.inf.tu-dresden.de>
Date: Fri, 5 Oct 2012 16:52:35 +0200
Subject: [PATCH 2/2] Do segmentation addr-translation with uint32's for
 32-bit guests

---
 src/ec_svm.cpp |    6 ++++--
 1 file changed, 4 insertions(+), 2 deletions(-)

diff --git a/src/ec_svm.cpp b/src/ec_svm.cpp
index 7e7f79f..b19cec8 100644
--- a/src/ec_svm.cpp
+++ b/src/ec_svm.cpp
@@ -83,7 +83,8 @@ void Ec::svm_exception (mword reason)
 
 void Ec::svm_invlpg()
 {
-    mword virt = static_cast<mword>(current->regs.vmcb->cs.base + current->regs.vmcb->rip);
+	mword virt = static_cast<uint32>(current->regs.vmcb->cs.base)
+			+ static_cast<uint32>(current->regs.vmcb->rip);
 
     current->regs.svm_update_shadows();
 
@@ -107,7 +108,8 @@ void Ec::svm_invlpg()
 
 void Ec::svm_cr()
 {
-    mword virt = static_cast<mword>(current->regs.vmcb->cs.base + current->regs.vmcb->rip);
+	mword virt = static_cast<uint32>(current->regs.vmcb->cs.base)
+			+ static_cast<uint32>(current->regs.vmcb->rip);
 
     current->regs.svm_update_shadows();
 
-- 
1.7.9.5

